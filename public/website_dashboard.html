<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="css/materialize.css">
    <link rel="stylesheet" href="css/prism.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<header>
    <ul id="nav-mobile" class="side-nav fixed" style="transform: translateX(0%);">
        <li class="valign-wrapper " style="height:64px;">
            <span class="logo-text " style="width:100%; text-align: center;">Materialize</span>
        </li>
        <li class="bold ">
            <a href="dashboard.html" class="waves-effect waves-light ">
                <i class="material-icons">dashboard</i>
                Dashboard
            </a>
        </li>
        <li class="bold active">
            <a href="websites.html" class="waves-effect waves-light">
                <i class="material-icons">web</i>
                Websites
            </a>
        </li>
        <li class="bold">
            <a href="messages.html" class="waves-effect waves-light"> <i
                    class="material-icons">insert_comment</i>
                Messages</a>
        </li>
        <li class="bold">
            <a href="settings.html" class="waves-effect waves-light">
                <i class="material-icons">settings</i>
                Settings
            </a>
        </li>

        <li><a class="waves-effect waves-light btn  deep-purple " href="#!" onclick="logout()">Logout</a></li>
    </ul>
</header>
<main class="with-sidenav">
    <div class="section" style="height:calc( 93vh - 45px); padding:0">

        <!--FAB-->
        <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
            <a class="btn-floating btn-large deep-purple tooltipped modal-trigger" data-position="left" data-delay="50"
               data-tooltip="Add Form" href="#add_form_modal">
                <i class="material-icons ">add</i>
            </a>
        </div>

        <!-- Navbar -->
        <nav>
            <div class="nav-wrapper deep-purple  " style="padding-left:20px;">
                <a href="#" data-activates="nav-mobile"
                   class="button-collapse top-nav full hide-on-large-only">
                    <i class="material-icons">menu</i>
                </a>
                <div class="col s12">
                    <a href="#!" class="breadcrumb">Websites</a>
                </div>
            </div>
        </nav>
        <!-- Content -->
        <div style="padding:1vh">

            <div class="row" style="width:100%;">


                <div class="col l6 m12 s12">
                    <div class="card" style="min-width:100%">
                        <div class="card-content black-text mh1">
                            <div>
                                <p id="website_name" class=" deep-purple-text m-0"
                                   style="font-size:30px;display:inline-block">Website Info </p>
                                <span style="font-size:15px;" id="only_https"> only HTTPS</span> <br>
                                <a id="website_url" class="deep-purple-text text-lighten-1 p-5" style="font-size:17px;">http://sostatic.xyz</a>
                                <!--, <a class="deep-purple-text text-lighten-2 p-5" style="font-size:14px;">http://sostatic.xyz</a>,
                                <a class="deep-purple-text text-lighten-2 p-5" style="font-size:14px;">http://sostatic.xyz</a> -->


                                <br>

                                <p class="bold deep-purple-text lighten-1 m-t-20  " style="display:inline-block">
                                    ReCAPTCHA

                                </p>

                                <p id="website_recaptcha_state" class="bold m-b-5"
                                   style="font-size:12px; display:inline-block">Disabled</p>
                                <div id="website_recaptcha_container">

                                    <p class="bold deep-purple-text lighten-1  m-b-10 " style="font-size:14px;">
                                        Secret
                                    </p>


                                    <a id="recaptcha_secret"
                                       class="deep-purple-text text-lighten-2 p-10 deep-purple lighten-5 truncate m-b-10">6LddK0QUAAAAAIfV8lbHc7J9VnwR0ZIMk2VS7t0P</a>


                                    <p class="bold deep-purple-text lighten-1 m-b-10 " style="font-size:14px;">
                                        Site-key
                                    </p>


                                    <a id="recaptcha_site_key"
                                       class="deep-purple-text text-lighten-2 p-10 deep-purple lighten-5 truncate m-b-10">6LddK0QUAAAAAIfV8lbHc7J9VnwR0ZIMk2VS7t0P</a>
                                </div>

                            </div>


                        </div>
                        <div class="card-action">
                            <a href="#edit_website_modal" class="bold deep-purple-text lighten-2 modal-trigger">Edit</a>

                        </div>
                    </div>

                </div>
                <div class="col l6 m12 s12">
                    <div class="card" style="min-width:100%">
                        <div class="card-content black-text mh1">
                            <div>
                                <span class=" deep-purple-text m-0" style="font-size:30px;">Contacts</span><br>
                                <div id="contacts_container">

                                </div>


                            </div>


                        </div>
                        <div class="card-action">
                            <a href="#add_contacts_modal" id="add_contacts_button"
                               class="bold deep-purple-text lighten-2 modal-trigger">Edit</a>

                        </div>
                    </div>

                </div>


                <div class="col s12 ">
                    <h5 class="m-0 deep-purple-text text-lighten-1"> Forms</h5>
                </div>


                <div class="col l4 m6 s12">
                    <div class="card">
                        <div class="card-content black-text ">
                            <div>
                                <span class=" deep-purple-text " style="font-size:26px;"> Form alias</span><br>
                                <a class="deep-purple-text text-lighten-2" style="font-size:12px;">Added on
                                    18-01-2017</a>
                                <br>

                                <p class="bold deep-purple-text lighten-1 m-t-20 " style="font-size:18px;">
                                    Messages 2/3
                                </p>


                                <div class="progress deep-purple lighten-4">
                                    <div class="determinate deep-purple lighten-1" style="width: 66%"></div>
                                </div>


                                <p class="bold deep-purple-text lighten-1 m-t-20 m-b-10" style="font-size:18px;">
                                    ReCAPTCHA
                                    <small style="font-size:12px;">Disabled</small>
                                </p>

                                <p class="bold deep-purple-text lighten-1 m-t-20 m-b-10" style="font-size:18px;">
                                    Endpoint:
                                </p>

                                <a class="deep-purple-text text-lighten-2 p-10 m-b-10 deep-purple lighten-5 truncate">http://localhost:63342/SoStatic/public/individual_websit</a>

                                <a class="p-10 bold deep-purple-text modal-trigger" href="#boilerplate_modal">Generate
                                    form boilerplate</a>


                            </div>


                        </div>
                        <div class="card-action">
                            <a href="individual_website.html" class="bold deep-purple-text lighten-2">Edit</a>

                        </div>
                    </div>

                </div>


            </div>


            <!-- Boilerplate Modal -->
            <div id="boilerplate_modal" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>Modal Header</h4>
                    <h6>Here is a sample code, filled with your information, for a form that will post to our
                        service</h6>

                    <pre>
                        <code class="language-markup">
                            <script type="prism-html-markup">
                                <form action="/action_page.php" target="_blank" method="GET">
                                    First name:<br>
                                    <input type="text" name="firstname" value="Mickey">
                                    <br>
                                    Last name:<br>
                                    <input type="text" name="lastname" value="Mouse">
                                    <br><br>
                                    <input type="submit" value="Submit">
                                </form>
                            </script>
                        </code>
                    </pre>

                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Close</a>
                    <a href="#!" class="modal-action waves-effect waves-green btn-flat ">Copy</a>
                </div>
            </div>

            <!-- Add form Modal -->
            <div id="add_form_modal" class="modal small-modal">
                <div class="modal-content">


                    <div class="container">

                        <h4>Add form</h4>


                        <div class="input-field tooltipped "
                             data-tooltip="Email to redirect the messages to (can add more later)" data-position="top">
                            <input id="last_name6" type="text">
                            <label for="last_name6" class="">Form Alias</label>
                        </div>


                        <p class="bold deep-purple-text lighten-1 m-0  ">
                            ReCAPTCHA
                        </p>


                        <div class="switch  tooltipped m-t-10" data-tooltip="Enable message filtering with recaptcha"
                             data-position="top" style="display:inline-block">
                            <label>
                                Off
                                <input type="checkbox">
                                <span class="lever deep-purple lighten-4"></span>
                                On
                            </label>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
                    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Add</a>
                </div>
            </div>

            <!-- Edit Contacts Modal -->
            <div id="add_contacts_modal" class="modal">
                <div class="modal-content">


                    <div class="container">
                        <h5 class="deep-purple-text lighten-1">Edit contacts</h5>


                        <div class="row" id="edit_contacts_list">

                            <div class="contacts-list-entry" data-entry-index="0">


                                <div class="input-field col s4 " style="padding-left:0;">
                                    <input id="single_contact_alias1" type="text" class="validate contacts-alias">
                                    <label for="single_contact_alias1">Alias</label>
                                </div>

                                <div class="input-field col s8 p-0">
                                    <input id="single_contact_email1" type="email" class="validate contacts-email">
                                    <label for="single_contact_email1">Email</label>
                                </div>

                            </div>
                            <div class="contacts-list-entry" data-entry-index="1">
                                <div class="input-field col s4 " style="padding-left:0;">
                                    <input id="single_contact_alias2" type="text" class="validate contacts-alias">
                                    <label for="single_contact_alias2">Alias</label>
                                </div>

                                <div class="input-field col s8 p-0">
                                    <input id="single_contact_email2" type="email" class="validate contacts-email">
                                    <label for="single_contact_email2">Email</label>
                                </div>
                            </div>

                            <div class="contacts-list-entry" data-entry-index="2">

                                <div class="input-field col s4 " style="padding-left:0;">
                                    <input id="single_contact_alias3" type="text" class="validate contacts-alias">
                                    <label for="single_contact_alias3">Alias</label>
                                </div>

                                <div class="input-field col s8 p-0">
                                    <input id="single_contact_email3" type="email" class="validate contacts-email">
                                    <label for="single_contact_email3">Email</label>
                                </div>

                            </div>

                            <div class="contacts-list-entry" data-entry-index="3">

                                <div class="input-field col s4 " style="padding-left:0;">
                                    <input id="single_contact_alias4" type="text" class="validate contacts-alias">
                                    <label for="single_contact_alias4">Alias</label>
                                </div>

                                <div class="input-field col s8 p-0">
                                    <input id="single_contact_email4" type="email" class="validate contacts-email">
                                    <label for="single_contact_email4">Email</label>
                                </div>


                            </div>

                            <div class="contacts-list-entry" data-entry-index="4">
                                <div class="input-field col s4 " style="padding-left:0;">
                                    <input id="single_contact_alias5" type="text" class="validate contacts-alias">
                                    <label for="single_contact_alias5">Alias</label>
                                </div>

                                <div class="input-field col s8 p-0">
                                    <input id="single_contact_email5" type="email" class="validate contacts-email">
                                    <label for="single_contact_email5">Email</label>
                                </div>
                            </div>


                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <a id="confirm_edit_contacts_button"
                       class="modal-action modal-close waves-effect waves-green btn-flat ">Agree</a>
                </div>
            </div>

            <!-- Edit Website Modal -->
            <div id="edit_website_modal" class="modal ">
                <div class="modal-content">


                    <div class="row">
                        <div class="col m6 offset-m3 s12 ">
                            <span class=" deep-purple-text m-0" style="font-size:25px;">Add Form</span><br>

                            <div class="input-field tooltipped " data-tooltip="An alias for your website"
                                 data-position="right">
                                <input id="edit_website_name" class="m-b-5" type="text">
                                <label for="edit_website_name" class="">Website Name</label>
                            </div>
                            <div class="input-field tooltipped "
                                 data-tooltip="We will only consider requests from this website to avoid spam  (can add domains later)"
                                 data-position="right">
                                <input id="edit_website_url" type="text">
                                <label for="edit_website_url" class="">Website URL</label>
                            </div>


                            <p style="display:inline-block" class=" tooltipped "
                               data-tooltip="Online consider messages sent from the HTTPS version of the site"
                               data-position="right">
                                <input type="checkbox" class="purple-checkbox" id="edit_only_https" checked/>
                                <label for="edit_only_https" class="deep-purple-text text-lighten-2 checkbox-label">Only
                                    HTTPs</label>
                            </p>


                            <p class="bold deep-purple-text lighten-1 m-0  ">
                                ReCAPTCHA
                            </p>


                            <div class="switch  tooltipped m-t-10"
                                 data-tooltip="Enable message filtering with recaptcha"
                                 data-position="right" style="display:inline-block">
                                <label>
                                    Off
                                    <input type="checkbox" id="edit_website_recaptcha_switch">
                                    <span class="lever deep-purple lighten-4"></span>
                                    On
                                </label>
                            </div>


                            <div class="m-t-20" id="edit_recaptcha_container">
                                <div class="input-field">
                                    <input id="edit_recaptcha_secret" type="text">
                                    <label for="edit_recaptcha_secret" class="">ReCAPTCHA Secret</label>
                                </div>

                                <div class="input-field">
                                    <input id="edit_recaptcha_sitekey" type="text">
                                    <label for="edit_recaptcha_sitekey" class="">ReCAPTCHA Site-key</label>
                                </div>
                            </div>

                        </div>


                    </div>


                </div>
                <div class="modal-footer">
                    <a class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
                    <a class="  waves-effect waves-green btn-flat" id="on_edit_website_confirm_button">Confirm</a>
                </div>
            </div>

        </div>
    </div>
</main>
</body>


<script id="contacts_template" type="x-tmpl-mustache">
    <ul class="collection ">

        {{#contacts}}
        <li class="collection-item">
            <div>
                <p class="deep-purple-text lighten-1 bold" style="display: inline-block;">{{alias}}</p> {{email}}
                <a class="secondary-content">
                    <i class="material-icons deep-purple-text text-lighten-1 pointer"
                       onclick="onDeleteContactClicked('{{email}}')">delete</i>
                    <i class="material-icons deep-purple-text text-lighten-1 pointer"
                       onclick="onPauseContactClicked('{{email}}')">pause</i>

                </a>
            </div>
        </li>
        {{/contacts}}
    </ul>
</script>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script type="text/javascript" src="js/firebase4.9.0.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript" src="js/prism.js"></script>
<script type="text/javascript" src="js/functionality.js"></script>
<script type="text/javascript" src="js/matchHeight.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.js"></script>

<script>


    //////////// CONTACTS THINGS ////////////

    let websiteElement = {
        websiteName: $("#website_name"),
        websiteUrl: $("#website_url"),
        onlyHttps: $("#only_https"),
        recaptchaState: $("#website_recaptcha_state"),
        websiteRecaptchaContainer: $("#website_recaptcha_container"),
        recaptchaSecret: $("#recaptcha_secret"),
        recaptchaSitekey: $("#recaptcha_site_key"),

        editWebsiteName: $("#edit_website_name"),
        editWebsiteUrl: $("#edit_website_url"),
        editWebsiteOnlyHttps: $("#edit_only_https"),
        editWebsiteRecaptchaSwitch: $("#edit_website_recaptcha_switch"),
        editWebsiteRecaptchaSecret: $("#edit_recaptcha_secret"),
        editWebsiteRecaptchaSitekey: $("#edit_recaptcha_sitekey"),
        editRecaptchaContainer: $("#edit_recaptcha_container"),
        editWebsiteConfirmButton: $("#on_edit_website_confirm_button"),

        init: function (website) {
            $(this.websiteName).text(website.alias);
            $(this.editWebsiteName).val(website.alias);

            $(this.websiteUrl).text(website.url);
            $(this.editWebsiteUrl).val(website.url);


            if (!website.httpsOnly) {

                $(this.onlyHttps).hide();
                $(this.editWebsiteOnlyHttps).prop("checked", false)
            }

            if (website.recaptcha) {

                $(this.recaptchaState).text("Enabled");
                $(this.recaptchaState).addClass("green-text");

                $(this.recaptchaSecret).text(website.secret);
                $(this.recaptchaSitekey).text(website.sitekey);


                $(this.editWebsiteRecaptchaSecret).val(website.secret);
                $(this.editWebsiteRecaptchaSitekey).val(website.sitekey);


                $(this.editWebsiteRecaptchaSwitch).prop("checked", true);

            } else {
                $(this.recaptchaState).text("Disabled");
                $(this.recaptchaState).addClass("red-text");
                $(this.websiteRecaptchaContainer).hide();

                $(this.editWebsiteRecaptchaSwitch).prop("checked", false);

            }
            this.updateEditRecaptchaSwitch(website.recaptcha);

            this.editWebsiteConfirmButton.on("click", this.onUpdateConfirmClicked);

            $(this.editWebsiteRecaptchaSwitch).on("change", function () {
                websiteElement.updateEditRecaptchaSwitch($(websiteElement.editWebsiteRecaptchaSwitch).prop("checked"));
            });

            contactsElement.init(website.contacts);

            Materialize.updateTextFields(); // fix overlapping label on text input
            matchHeightUpdate();
        },
        onUpdateConfirmClicked: function () {

            let updateObj = {
                'alias': $(websiteElement.editWebsiteName).val(),
                'url': $(websiteElement.editWebsiteUrl).val(),
                'httpsOnly': $(websiteElement.editWebsiteOnlyHttps).prop("checked"),
                'recaptcha': $(websiteElement.editWebsiteRecaptchaSwitch).prop("checked"),
                'secret': $(websiteElement.editWebsiteRecaptchaSecret).val(),
                'sitekey': $(websiteElement.editWebsiteRecaptchaSitekey).val()
            };

            console.log(updateObj);
            let websiteId = $.getUrlVar('website_id');

            updateWebsite(websiteId, updateObj, () => {
                window.location.reload();
            });


        },
        updateEditRecaptchaSwitch: function (checked) {
            if (checked)
                $(websiteElement.editRecaptchaContainer).show();
            else
                $(websiteElement.editRecaptchaContainer).hide();
        }


    };

    let contactsElement = {
        template: $("#contacts_template").html(),
        container: $("#contacts_container"),
        editContactsInputList: $("#edit_contacts_list"),
        addContactsButton: $("#add_contacts_button"),
        confirmEditContactsButton: $("#confirm_edit_contacts_button"),

        init: function (contacts) {
            Mustache.parse(this.contactsTemplate);


            if (contacts !== undefined) {
                let rendered = Mustache.render(this.template, {'contacts': contacts});
                $(this.container).html(rendered);
            }


            $(this.editContactsInputList).find('.contacts-list-entry').each(function () {
                let aliasInput = $(this).find('.contacts-alias');
                let emailInput = $(this).find('.contacts-email');
                let idx = $(this).data('entry-index');

                if (contacts !== undefined) {
                    if (contacts[idx] !== undefined) {
                        aliasInput.val(contacts[idx].alias);
                        emailInput.val(contacts[idx].email);
                    }
                }

            });

            $(this.confirmEditContactsButton).on('click', this.onConfirmClicked);


        },
        onConfirmClicked: function () {
            let contacts = [];
            $(contactsElement.editContactsInputList).find('.contacts-list-entry').each(function () {

                let aliasInput = $(this).find('.contacts-alias');
                let emailInput = $(this).find('.contacts-email');
                if (aliasInput.val().length >= 1) {
                    contacts.push({
                        'alias': aliasInput.val(),
                        'email': emailInput.val()
                    });
                }
            });

            updateContacts($.getUrlVar('website_id'), contacts, function () {
                window.location.reload()
            });

        }

    };


    firebase.auth().onAuthStateChanged(function (user) {
        if (!user) {
            window.location.href = "authentication.html";
        } else {
            let websiteId = $.getUrlVar('website_id');
            getWebsiteById(websiteId, onWebsiteLoaded);

        }
    });


    function onWebsiteLoaded(website) {
        websiteElement.init(website);
        console.log(website);
    }

</script>
</html>
