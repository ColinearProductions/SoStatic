<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/materialize.css">

    <link rel="stylesheet" href="css/styles.css">


</head>
<body>


<main>

    <div class="section   deep-purple lighten-1 valign-wrapper"
         style="height:calc( 100vh ); background-image: url('images/Photoshop/Untitled-1.png') ">

        <div class="overlay-container valign-wrapper " style="display:none">
            <div class="card-panel center p-40">
                <div class="preloader-wrapper big active">
                    <div class="spinner-layer spinner-blue-only">
                        <div class="circle-clipper left">
                            <div class="circle"></div>
                        </div>
                        <div class="gap-patch">
                            <div class="circle"></div>
                        </div>
                        <div class="circle-clipper right">
                            <div class="circle"></div>
                        </div>
                    </div>
                </div>

                <p class="overlay-message">
                    We are creating your account
                </p>
            </div>
        </div>


        <div class="container ">


            <div class="row m-0" style="width:100%; background-color:whitesmoke">
                <div class="">
                    <ul class="tabs">
                        <li class="tab col s3"><a href="#login_tab" class="deep-purple-text  text-lighten-1">Login</a>
                        </li>
                        <li class="tab col s3"><a href="#register_tab"
                                                  class="deep-purple-text  text-lighten-1">Register</a></li>
                        <li class="tab col s3"><a href="#recover_tab"
                                                  class="deep-purple-text  text-lighten-1">Recover</a></li>
                        <div class="indicator deep-purple lighten-1" style="z-index:1"></div>
                    </ul>
                </div>


                <div id="login_tab" class="col s12 p-20" style="height:55vh; width:100%">

                    <div class="valign-wrapper" style="height:100%">

                        <div class="col xl8 s10 offset-xl2 offset-s1">

                            <h3 class="header m-b-15  deep-purple-text  text-lighten-1"> Login </h3>
                            <div class="row">
                                <div class="input-field col s12 ">
                                    <input id="login_email" type="email"
                                           class="validate m-0  deep-purple-text  text-lighten-1">
                                    <label for="login_email" class=" deep-purple-text  text-lighten-1">Email</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="login_password" type="password"
                                           class="validate m-0   deep-purple-text  text-lighten-1">
                                    <label for="login_password"
                                           class=" deep-purple-text  text-lighten-1">Password</label>
                                </div>
                            </div>


                            <div class="row">
                                <a class="waves-effect waves-light btn center-align deep-purple lighten-1"
                                   onclick="onLoginPressed()">Login</a>


                            </div>
                            <a class="deep-purple-text text-lighten-3 goto_tab center-align" data-target="recover_tab"
                               href="#!">Forgot your password?</a>
                            <a class="deep-purple-text text-lighten-3  goto_tab center-align"
                               style="float: left; padding-right:20px;" data-target="register_tab" href="#!">Dont have
                                an account?</a>

                        </div>
                    </div>
                </div>
                <div id="register_tab" class="col p-20" style="height:55vh; width:100%">


                        <div class="valign-wrapper" style="height:100%">
                            <div class="col xl8 s10 offset-xl2 offset-s1">
                                <h3 class="header m-b-15 deep-purple-text  text-lighten-1"> Register </h3>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <input id="register_email" type="text"
                                               class=" deep-purple-text  text-lighten-1  m-0 mvalidate"
                                                data-validate-email data-validate-required>
                                        <label for="register_email">Email</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <input id="register_password" type="password"
                                               class=" deep-purple-text  text-lighten-1  m-0 mvalidate"
                                               data-validate-required data-min-length="6"
                                              >

                                        <label for="register_password">Password</label>
                                    </div>
                                </div>

                                <p>
                                    <input type="checkbox" class="purple-checkbox" id="test5"/>
                                    <label for="test5" class="deep-purple-text text-lighten-2">Subscribe to our
                                        newsletter</label>
                                </p>

                                <button  class="waves-effect waves-light btn  deep-purple lighten-1"
                                        onclick="onRegisterPressed()">
                                    Register
                                </button>

                            </div>

                        </div>


                </div>
                <div id="recover_tab" class="col p-20" style="height:55vh; width:100%">
                    <div class="valign-wrapper" style="height:100%">
                        <div class="col xl8 s10 offset-xl2 offset-s1">
                            <h3 class="header m-b-15 deep-purple-text  text-lighten-1"> Recover </h3>
                            <h6> Enter your email, we will send you the steps required to recover your account</h6>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="recover_email" type="email"
                                           class=" deep-purple-text  text-lighten-1  m-0">
                                    <label for="recover_email">Email</label>
                                </div>
                            </div>

                            <a class="waves-effect waves-light btn  deep-purple lighten-1" href="#!"
                               onclick="onSendRecoveryEmailPressed()">Send Recovery Email</a>
                        </div>
                    </div>
                </div>

                <div class="row m-0 right-align">
                    <a class="btn-floating btn-large waves-effect waves-light deep-purple lighten-1"
                       style="margin-right:30px; margin-bottom:30px;" href="index.html"><i
                            class="material-icons">arrow_back</i></a>
                </div>


            </div>


        </div>


    </div>


</main>

</body>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
<script type="text/javascript" src="js/script.js"></script>


<script>
    $(".button-collapse").sideNav();

    $(document).ready(function () {
        // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
        $('.modal').modal();
        $('ul.tabs').tabs();
    });


    function select_tab(id) {
        $('ul.tabs').tabs('select_tab', id);
    }

    $(".goto_tab").on("click", function () {
        select_tab($(this).data("target"));
    });


    let registerEmailField = $("#register_email");
    let registerPasswordField = $("#register_password");

    let loginEmailField = $("#login_email");
    let loginPasswordField = $("#login_password");

    let recoveryEmailField = $("#recover_email");


    let state = null;

    let overlay = $(".overlay-container");


    function showLoading(message) {
        $(overlay).find(".overlay-message").text(message);
        $(overlay).show();
    }

    function hideLoading() {
        $(overlay).hide();
    }


    function onRegisterPressed() {

        if(!isFormCompleted($("#register_tab")))
            return;


        register($(registerEmailField).val(), $(registerPasswordField).val(), function (error) {
            hideLoading();
            state = null;
            alert(error.message);
        });
        state = "registering";
        showLoading("We are creating your account...");
        return ;
    }

    function onLoginPressed() {
        login($(loginEmailField).val(), $(loginPasswordField).val(), function (error) {
            hideLoading();
            state = null;
            alert(error.message);
        });
        state = "logging-in";
        showLoading("Logging in");
    }


    function onSendRecoveryEmailPressed() {
        showLoading("Sending recovery email");
        forgotPassword($(recoveryEmailField).val(), function (error) {
            if (error === undefined) {
                Materialize.toast('You should receive a recovery email soon', 4000); // 4000 is the duration of the toast
            } else {
                Materialize.toast('There has been an error: ' + error.message, 4000); // 4000 is the duration of the toast
            }
            hideLoading();
        })
    }


    firebase.auth().onAuthStateChanged(function (user) {
        console.log(user);
        if (user) {

            if (state === "registering") {
                hideLoading();
                Materialize.toast('Succesfully registered', 4000);// 4000 is the duration of the toast
                state = null;
            } else if (state === "logging-in") {
                hideLoading();
                state = null;
                Materialize.toast('Succesfully logged in', 4000); // 4000 is the duration of the toast
            } else {
                Materialize.toast('Welcome back ' + user.email, 4000); // 4000 is the duration of the toast
            }


        } else {
            hideLoading();
        }
    });


    $("form").validate();

</script>
</html>
